---
title: 编译原理
---

# 编译原理

> 我们都知道 JavaScript 一门[解释型](https://zh.wikipedia.org/wiki/直譯語言)编程语言。但是事实上它是一门**编译型**语言。
> 
> 这句话可能听起来有点矛盾，其实说明了 JavaScript 的双重特性：**语法层面的动态解释型语言​​**与​**​现代引擎执行时的编译型机制**。

在传统的编译型语言的流程中，程序中的一段源代码在执行之前会经历三个步骤，三个步骤统称为为“编译”，分别是：词法分析、语法分析、代码生成。而 JavaScript 引擎的编译过程则要复杂的多。具体我们继续往下看。

:::details 分词/词法分析（Tokenizing/Lexing）
即源码字符串被分割成有意义的代码块，这些代码块被称为词法单元（token）。如：var a = 2; 这段代码会被分解成 var、a、=、2。空格是否需要则取决于空格在这门语言中是否具有意义。
:::

:::details 解析/语法分析（Parsing）
这个过程则是将词法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree，AST）。
:::

:::details 代码生成
将 AST 转换为可执行代码的过程称为代码生成。这个过程与语言、目标平台等息息相关。

抛开细节，简单来说，代码生成过程就是有某种方法将“AST”转换为一组机器指令，比如给变量 a 分配内存，并将值 2 存储在 a 中。
:::

与其它语言不通，JavaScript 的编译过程并不是发生在构建之前的，编译发生在代码执行前的几微秒（甚至更短！）的时间内。在后续的作用域背后，JavaScript 引擎用尽了各种办法（比如 JIT，可以延迟编译甚至实施重编译）来保证性能最佳。

简单来说，任何 JavaScript 代码片段在执行前都要进行编译（通常就在执行之前）。因此，JavaScript 编译器首先会对 var a = 2; 这段程序进行编译，然后做好执行它的准备，并且通常马上就会执行它。