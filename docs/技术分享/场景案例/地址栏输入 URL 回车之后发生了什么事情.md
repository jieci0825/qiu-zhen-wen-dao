---
title: 地址栏输入 URL 回车之后发生了什么事情
---

# 地址栏输入 URL 回车之后发生了什么事情

## 概述
- DNS 解析出 IP 地址
- 建立 TCP 连接
- 客户端发出 HTTP 请求
- 服务端响应 HTTP 请求
- 浏览器解析 HTML CSS
- 渲染 DOM
- 执行 JS 代码，可能会 ajax 加载内容，再次渲染 DOM
- 加载媒体资源
- 浏览器缓存机制

## 详情

1. **URL 解析**
:::details 详情
    - **协议**：最常用的比如HTTP（超文本传输协议）FTP（文件传输协议）
    - **纠错**：URL 有没有输入完成，或者是否合法
    - **补全**：自动补全协议、域名、路径等
    - **转码**：比如非ASCII 字符进行编码
    而如果不合法的地址，会转给默认的搜索引擎，比如百度一下。
:::

2. **DNS 解析** 
:::details 详情
[域名解析过程](../网络/域名解析过程.md)
:::

3. **TCP 连接**（三次握手）
:::details 详情
[TCP三次握手和四次挥手](../网络/TCP%20三次握手和四次挥手.md)
:::

4. **准备请求**
:::details 详情
    与服务器建立了连接后，就可以向服务器发起请求了，而根据HTTP协议的要求，组织一个HTTP数据包，一般需要包含以下内容：
    - **请求行**：请求方法、URL、协议版本
    - **请求头**：Host、Cookie、User-Agent、Cache-Control、Content-Type、Authorization等等。
:::

5. **发送请求**：一般是 GET
6. **服务器处理请求**：在这个过程中，通常服务器会执行一些操作，比如查询数据库(MySQL、Redis等)、访问文件系统等等。这个服务器可能是一个 BFF 中间层，或者是后端服务等等。

7. **服务器响应**：在 HTTP 中，有请求就会有响应，错误信息也会有响应，一般响应包中会包含 HTTP状态码、响应头、响应体等等。

8. **浏览器接收响应头**：浏览器会先接收到响应头，然后对响应头进行处理，如判断状态码，若是 301/302，则进行重定向，而 404，则显示资源未找到，如果是 200，则继续处理，如果是 500，则显示服务器错误等等。还有什么 set-cookie 就设置 cookie，以及耳熟能详的 Content-Type，告诉浏览器返回的响应体是什么类型，通过这个就可以告诉浏览器以什么方式来处理这个响应体。还有一些其他的操作，比如 Last-Modified、Cache-Control 等等。

9. **收响应体**：响应体一般不会等待全部都接收完成才处理，一般收到多少就处理多少，因为响应体可能很大，所以需要分块传输。
10. **渲染**
:::details 详情
    一般在 HTML 的类型中，收响应体就是渲染的过程，渲染的过程详解可以查看我的另外一篇文章 [浏览器渲染原理](../浏览器/浏览器渲染原理.md)
:::

11. **关闭连接**（四次挥手）
:::details 详情
    一般网络传输完成之后(即响应体收完之后)就会断开，但是具体是否断开一般会看服务器是不要维持保活(connection: keep-alive)还是关闭连接(connection: close)，如果是保活，那么连接就会保持一段时间，这个时间由服务器决定，而客户端也会在这个时间内，继续接收服务器发送的数据，如果在这个时间内，服务器没有发送数据，那么客户端就会关闭连接。

    [TCP三次握手和四次挥手](../网络/TCP%20三次握手和四次挥手.md)
:::