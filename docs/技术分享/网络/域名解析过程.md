---
title: 域名解析过程
---

# 域名解析过程

## 简述

1. 查找本机 hosts 文件是否有解析记录，如果有，直接使用
2. 查找本地域名服务器中是否有解析记录，如果有，直接使用
3. 查询根域名服务器，得到顶级域名服务器ip
4. 查询顶级域名服务器中是否有解析记录，如果有，直接使用
5. 根据顶级域名服务器返回的ip，查询（权威/权限）域名服务器，如果有解析记录，直接使用
6. 如果以上都找不到，则域名解析失败

## 详细

**DNS(域名系统 Domain Name System)** 查询过程是将人可读的域名（如 www.example.com）解析为机器可识别的 IP 地址（如 192.168.1.1）。这个过程包含多个步骤。
- **本地 DNS 缓存**：查询一个站点时，会查本地的 DNS 缓存，查看本地的缓存中是否缓存了该域名的 IP 地址，如果缓存了，则结束本次查询，让浏览器直接使用缓存的 IP 地址。如果不在则进行后续步骤。
- **DNS 查询开始**：即本地缓存中无法找到，操作系统会向配置的 DNS 服务器发送查询请求。
- **向本地 DNS 服务器发送查询请求**：
    - 本地的 DNS 服务器一般由 ISP（互联网服务提供商）提供，比如电信、联通等。客户端会向 ISP 提供的 DNS 服务器发送查询请求。
    - 然后本地 DNS 服务器会检测自己是否缓存了这个域名的 IP 地址。如果缓存了，则直接返回 IP 地址给客户端，结束本次查询。
    - 如果没有缓存，则本地 DNS 服务器会向根 DNS 服务器发送查询请求。
- **根 DNS 服务器（Root DNS Server）**：
    - 根 DNS 服务器是 DNS 系统的顶级服务器，负责指向管理顶级域（如 .com、.org、.net）的 DNS 服务器。
    -根 DNS 服务器不会返回最终的 IP 地址，但它会返回负责该顶级域名（如 .com）的权威 DNS 服务器的 IP 地址。
- **顶级域名服务器（TLD DNS Server）**：
    - 根 DNS 服务器将查询请求转发到对应的 **TLD DNS 服务器**，例如，对于域名 www.example.com，根 DNS 服务器会将请求转发到管理 .com 域的 TLD DNS 服务器。
    - 而 TLD DNS 服务器知道哪些服务器管理特定二级域名（例如 example.com），它会将请求进一步转发到该域名的权威 DNS 服务器。
- **权威 DNS 服务器（Authoritative DNS Server）**：
    - 权威 DNS 服务器 是最终的 DNS 服务器，它存储着该域名的详细记录，包括 A 记录（IPv4 地址）、AAAA 记录（IPv6 地址）、MX 记录（邮件服务器）、CNAME 记录（别名）等。
    - 权威 DNS 服务器接收到查询请求后，会返回该域名的 IP 地址（通常是 A 记录或 AAAA 记录）。
- **返回 IP 地址**：返回的 IP 地址就会根据之前的步骤，逐级的返回给客户端，客户端（浏览器）得到 IP 地址后，就可以使用这个 IP 地址与目标服务器建立连接。
- **缓存结果**：客户端和本地 DNS 服务器通常会缓存返回的结果，以便未来可以直接使用缓存的数据，而不需要重新执行查询。缓存的有效期由 DNS 记录中的 TTL（Time To Live）值控制。
- **浏览器连接**：获得 IP 地址，浏览器就可以使用该 IP 地址与目标服务器建立 TCP 连接，发送 HTTP 请求，加载网站内容。