---
title: 什么是跨域？如何解决？
---

# 什么是跨域？如何解决？

## 什么是跨域？
> 跨域是指浏览器的**同源策略限制**，当前域名的 JavaScript 代码试图访问其他域名下的资源时会受到限制。
> 
> 详情可以查阅我的其他文章 [跨域及其解决方案](https://blog.csdn.net/qq_53109172/article/details/129302403)

### 同源策略
想要理解跨域，那么同源策略是绕不开的，同源策略是**浏览器的一套安全机制**。这套策略中，存在一个规则，当一个源的文档或脚本，与另一个源的资源进行通信时，同源策略就会对这个通信做出**不同程度的限制**。

即对同源资源放行对非同源资源限制，因为这个限制而造成的问题，就被我们称之为跨域问题。

Tips：注意是 浏览器 中的同源策略，也就意味着在浏览器中才会出现这个所谓的跨域。

### 同源和非同源
```
源 = 协议 + 域名 + 端口
```
**同源**：协议、域名、端口都相同。

**非同源**：协议、域名、端口有一个不同。

### 跨域出现的场景
跨域一般会出现在如下三种场景中：
- 网络通信：a元素的跳转、加载css、js等文件、AJAX等。
- JS API：window.open打开新的页面 等。
- 存储：localStorage、sessionStorage等。

## 跨域解决方案

### CORS（跨域资源共享）
- 服务器设置 Access-Control-Allow-Origin 等响应头。
- 可以配置允许的请求方法、请求头、是否允许携带认证信息等。
- 最常用的跨域解决方案。

### JSONP
- 利用 `<script>` 标签不受同源策略限制的特点。
- 只支持 GET 请求。
- 需要服务器配合返回 JavaScript 代码。

### 代理服务器
- 开发环境：webpack-dev-server、vite 等的 proxy 配置。
- 生产环境：Nginx 反向代理。

### postMessage
- HTML5 标准中的 API。
- 用于不同窗口间的跨域通信。
- 可以在父子页面（iframe）或者多窗口间通信。

### WebSocket
- 建立在 TCP 之上的协议。
- 天然支持跨域。
- 适合需要实时通信的场景。

### document.domain（已废弃）
- 仅适用于主域名相同的情况。
- 将子域和主域的 document.domain 设为相同的主域。

### 最佳实践
- 优先使用 CORS，配置得当的情况下最安全。
- 需要兼容旧浏览器时可以考虑 JSONP。
- 开发环境优先使用代理服务器。
- 特殊场景（如页面通信）可以考虑 postMessage。
- 需要实时通信时使用 WebSocket。
